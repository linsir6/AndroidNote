# 浅析RPC协议

> RPC是一种通过网络从远程计算机程序上请求服务，而不需要了解底层网络技术的协议。RPC协议假定某些传输协议的存在，如TCP或UDP，为通信程序之间携带信息数据。在OSI网络通信模型中，RPC跨越了传输层和应用层。RPC使得开发包括网络分布式多程序在内的应用程序更加容易。 
RPC采用客户机/服务器模式。请求程序就是一个客户机，而服务提供程序就是一个服务器。首先，客户机调用进程发送一个有进程参数的调用信息到服务进程，然后等待应答信息。在服务器端，进程保持睡眠状态直到调用信息到达为止。当一个调用信息到达，服务器获得进程参数，计算结果，发送答复信息，然后等待下一个调用信息，最后，客户端调用进程接收答复信息，获得进程结果，然后调用执行继续进行。





![RPC工作原理](https://raw.githubusercontent.com/astaxie/build-web-application-with-golang/master/zh/images/8.4.rpc.png)

工作流程:

1.调用客户端句柄；执行传送参数
2.调用本地系统内核发送网络消息
3.消息传送到远程主机
4.服务器句柄得到消息并取得参数
5.执行远程过程
6.执行的过程将结果返回服务器句柄
7.服务器句柄返回结果，调用远程系统内核
8.消息传回本地主机
9.客户句柄由内核接收消息
10.客户接收句柄返回的数据

RPC算法中一些需要我们解决的问题：

1.通讯问题，可以是建立tcp链接，在通信成功后释放链接，也可以保持长链接
2.寻址问题，需要知道服务器的ip地址，端口，方法名等，所以需要注册服务中心
3.传输过程中，不可避免的就是序列化和反序列化的过程

以上的问题，我们都可以在rpc 的开源框架中找到解决方案。
